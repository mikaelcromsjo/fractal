Here’s a detailed overview of the **functions in both `service_account.py` and `telegram_bot.py`** including their **purpose, inputs, and outputs**. I’ve structured it like a reference doc for your project.

---

## **`service_account.py` – Service Account Adapter**

| Function                                   | Description                                                                  | Inputs                                                                          | Outputs                                           |
| ------------------------------------------ | ---------------------------------------------------------------------------- | ------------------------------------------------------------------------------- | ------------------------------------------------- |
| `start_client()`                           | Initializes and starts the Telethon client. Ensures the client is connected. | None                                                                            | `None` (connects async Telethon client)           |
| `create_group(title, user_ids)`            | Creates a private Telegram group with initial members.                       | `title: str` – group name<br>`user_ids: List[int]` – Telegram user IDs          | `chat_id: int` – Telegram ID of the created group |
| `add_users_to_group(chat_id, user_ids)`    | Adds multiple users to an existing group.                                    | `chat_id: int` – Telegram group ID<br>`user_ids: List[int]` – Telegram user IDs | `None`                                            |
| `generate_invite_link(chat_id)`            | Generates an invite link for a Telegram group.                               | `chat_id: int`                                                                  | `link: str` – invite URL                          |
| `dm_invite_link(user_id, link)`            | Sends a direct message to a user with the invite link.                       | `user_id: int` – Telegram user ID<br>`link: str` – invite URL                   | `None`                                            |
| `add_bot_to_group(bot_id, chat_id)`        | Adds a bot to the group.                                                     | `bot_id: int` – Telegram bot user ID<br>`chat_id: int` – group ID               | `None`                                            |
| `fetch_group_members(chat_id)`             | Returns the list of Telegram user IDs in a group.                            | `chat_id: int`                                                                  | `List[int]` – user IDs                            |
| `remove_user_from_group(chat_id, user_id)` | Removes a user from a Telegram group.                                        | `chat_id: int`<br>`user_id: int`                                                | `None`                                            |

**Notes:**

* All functions are asynchronous and should be called with `await`.
* Errors are logged and raised.
* Designed for backend service logic (Fractal governance) to manage Telegram groups programmatically.

---

## **`telegram_bot.py` – Bot Adapter (python-telegram-bot)**

| Command / Function                             | Description                                                                          | Inputs                                                                | Outputs                                    |
| ---------------------------------------------- | ------------------------------------------------------------------------------------ | --------------------------------------------------------------------- | ------------------------------------------ |
| `/start_fractal`                               | Creates a new fractal via API call.                                                  | `name: str` – fractal name<br>`description: str`<br>`start_date: str` | `success/failure message` (sent to user)   |
| `/join`                                        | Join an existing fractal.                                                            | `name: str` – fractal name                                            | `confirmation message`                     |
| `/proposal`                                    | Submit a proposal.                                                                   | `name: str`, `description: str`                                       | `confirmation`                             |
| `/proposal_vote`                               | Vote on a proposal.                                                                  | `proposal_id: int`<br>`vote: int` (1-10)                              | `confirmation`                             |
| `/comment`                                     | Comment on proposal or comment.                                                      | `target_id: int` – proposal or comment<br>`text: str`                 | `confirmation`                             |
| `/comment_vote`                                | Vote on a comment.                                                                   | `comment_id: int`<br>`vote: str` ("yes"/"no")                         | `confirmation`                             |
| `/todo`                                        | Show user pending actions (proposals/comments to vote on, representative selection). | None                                                                  | Text list of pending actions               |
| `/status`                                      | Show current voting status for proposals and comments.                               | None                                                                  | Text summary of proposals, comments, votes |
| `validate_user(update, context)`               | Internal helper to ensure user exists in backend.                                    | `update` – telegram update object                                     | `user_id: int` (or error)                  |
| `call_backend(endpoint, payload)`              | Internal helper to make HTTP request to FastAPI backend.                             | `endpoint: str`<br>`payload: dict`                                    | `backend response dict`                    |
| `inline_vote_keyboard(items, callback_prefix)` | Generates inline keyboard buttons for voting.                                        | `items: list` – IDs/labels<br>`callback_prefix: str`                  | Telegram `InlineKeyboardMarkup` object     |
| `handle_callback(update, context)`             | Handles button presses (inline votes).                                               | `update`, `context`                                                   | Sends updated vote confirmation or error   |

**Notes:**

* Bot commands are synchronous from user perspective but call FastAPI backend via HTTP requests.
* Inline keyboards allow easy voting interaction.
* Designed for minimal logic in bot; all state is stored and validated via backend API.

---


