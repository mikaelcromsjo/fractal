<div class="proposal-card" data-proposal-id="${proposal['id']}">
    <!-- Header: avatar + name + date -->
    <div class="proposal-header-row">
        <div class="proposal-userblock">
            <img src="${user['avatar']}" alt="${user['username']}" class="proposal-avatar">
            <div class="proposal-usertext">
                <a href="/profile/${user['id']}/"
                   data-uid="${user['id']}"
                   class="proposal-username usertooltip">
                    ${user['username']}
                </a>
                <div class="proposal-date">
                    ${proposal['date']}
                </div>
            </div>
        </div>
        % if proposal.get("score"):
            <div class="proposal-score-pill">
                Score: ${proposal['score']}
            </div>
        % endif
    </div>

    <!-- Title + description -->
    <div class="proposal-main">
        <h2 class="proposal-title">${proposal['title']}</h2>
        <p class="proposal-text">${proposal['message']}</p>

        % if proposal.get('tags'):
            <div class="proposal-tags">
                % for tag in proposal['tags']:
                    <span class="proposal-tag">#${tag}</span>
                % endfor
            </div>
        % endif
    </div>

    <!-- Slider -->
    <div class="proposal-rating-block">
        <div class="proposal-rating-top">
            <span>Rate proposal</span>
            <span class="proposal-rating-value"
                  id="rating-value-${proposal['id']}">
                ${proposal.get('rating_points', 5)} / 10
            </span>
        </div>
        <input
            type="range"
            min="1"
            max="10"
            step="1"
            value="${proposal.get('rating_points', 5)}"
            class="proposal-slider"
            id="rating-slider-${proposal['id']}"
            oninput="onRatingChange(${proposal['id']}, this.value)"
            onchange="onRatingCommit(${proposal['id']}, this.value)"
        >
    </div>

    <!-- Comments list -->
    <div class="proposal-comments-block">
        <div class="proposal-comments-header">
            Comments
        </div>
        <div class="proposal-comments-list" id="comments-list-${proposal['id']}">
            % if proposal.get('comments'):
                % for comment in proposal['comments']:
                    <div class="proposal-comment-row">
                        <img src="${comment['avatar']}"
                             alt="${comment['username']}"
                             class="proposal-comment-avatar">
                        <div class="proposal-comment-content">
<div class="proposal-comment-top">
    <span class="proposal-comment-username">
        ${comment['username']}
    </span>
    <span class="proposal-comment-date">
        ${comment['date']}
    </span>
    <span class="proposal-comment-vote">
        <span
            class="comment-vote-btn comment-vote-minus"
            onclick="voteComment(${comment['id']}, -1)"
        >âˆ’</span>
        <span
            class="comment-vote-score"
            id="comment-vote-score-${comment['id']}"
        >
            ${comment.get('score', 0)}
        </span>
        <span
            class="comment-vote-btn comment-vote-plus"
            onclick="voteComment(${comment['id']}, 1)"
        >+</span>
    </span>
</div>
            <div class="proposal-comment-text">
                ${comment['text']}
            </div>
                        </div>
                    </div>
                % endfor
            % else:
                <div class="proposal-comment-empty">
                    No comments yet.
                </div>
            % endif
        </div>

        <!-- Comment input -->
        <div class="proposal-comment-input-row">
            <textarea
                class="proposal-comment-input"
                id="comment-input-${proposal['id']}"
                rows="1"
                placeholder="Add a comment..."
                onkeydown="if(event.key==='Enter' && !event.shiftKey){event.preventDefault();submitProposalComment(${proposal['id']});}"></textarea>
            <button
                type="button"
                class="proposal-comment-send-btn"
                onclick="submitProposalComment(${proposal['id']});">
                Send
            </button>
        </div>
    </div>
</div>
